<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DJ Journey Tracker v8 — XP & Badges</title>
  <meta name="description" content="Track student XP, attendance, badges, and curriculum tasks for a DJ program." />
  <!-- Tailwind CSS via jsDelivr CDN -->
  <script defer src="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.13/lib/index.min.js"></script>
  <!-- React 18 + ReactDOM via jsDelivr (pinned versions) -->
  <script defer src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <style>
    /* Minimal fallback styles if Tailwind fails to load */
    .container { max-width: 1024px; margin: 0 auto; padding: 1rem; }
    .card { border: 1px solid #e5e7eb; border-radius: 1rem; padding: 1rem; background: #ffffff; box-shadow: 0 1px 2px rgba(0,0,0,0.04); }
    .btn { border: 1px solid #e5e7eb; border-radius: 0.75rem; padding: 0.25rem 0.75rem; background: white; cursor: pointer; }
    .btn-primary { background: #111827; color: white; }
    .muted { color: #6b7280; font-size: .875rem; }
    .input { border: 1px solid #e5e7eb; border-radius: .75rem; padding: .5rem .75rem; }
    body { background: #f9fafb; color: #111827; }
  </style>
</head>
<body>
  <div id="root" class="container"></div>

  <script type="text/javascript">
  // Wrap after window load to ensure CDNs are available
  window.addEventListener('load', function () {
    if (!(window.React && window.ReactDOM)) {
      document.getElementById('root').innerHTML = '<div class="card">\
        <h2 style="font-weight:600;margin-bottom:.5rem">CDN Blocked</h2>\
        <p class="muted">Your network might be blocking the JS libraries. Try a different network or the other index.html I provided.</p>\
      </div>';
      return;
    }
    const { useEffect, useMemo, useState } = React;

    const STORAGE_KEY = "dj_journey_tracker_v8";
    const uid = () => Math.random().toString(36).slice(2, 9);
    const today = () => new Date().toISOString().slice(0, 10);

    function useLocalState(key, initial) {
      const [state, setState] = useState(() => {
        try {
          const raw = localStorage.getItem(key);
          return raw ? JSON.parse(raw) : initial;
        } catch (e) { return initial; }
      });
      useEffect(() => {
        try { localStorage.setItem(key, JSON.stringify(state)); } catch (e) {}
      }, [key, state]);
      return [state, setState];
    }

    // Curriculum helpers
    const W = (w, unit, title, tasks, badge) => ({ w, unit, title, tasks: tasks.map((t, i) => ({ id: \`\${w}-\${i+1}\`, ...t })), badge });
    const T = (title, xp, type = "class") => ({ title, xp, type });
    const Challenge = (title, xp = 30) => T(\`Challenge: \${title}\`, xp, "challenge");
    const Side = (title, xp = 25) => T(\`Side Quest: \${title}\`, xp, "sidequest");
    const Wellness = (title, xp = 0) => T(\`Wellness: \${title}\`, 0, "wellness");
    const Portfolio = (title, xp = 0) => T(\`Portfolio: \${title}\`, xp, "portfolio");

    const weeksDetailed = [
      W(1, "Unit 1 — Starter Region", "Welcome to DJing", [
        T("Mon: Notes on Parts of a DJ Setup", 10),
        T("Mon: Track Analysis", 10),
        Wellness("Protect your hearing — never redline"),
        Portfolio("Draw + label gear diagram"),
        Side("Setup Scout — explain signal flow to a peer", 20),
        T("Tue: Identify controller parts (guided)", 20),
        T("Wed: Practice headphone cue buttons (lab)", 20),
        Portfolio("Cue diagram annotated"),
        Challenge("Thu: Identify 5 gear parts + cue one track", 30),
        Side("Film yourself explaining gear to a parent/friend", 25),
      ]),
      W(2, "Unit 1 — Starter Region", "Song Structure & Track Anatomy", [
        T("Mon: Bars, phrases, intros, outros", 20),
        Wellness("Stand straight, avoid wrist strain"),
        Portfolio("Mark sections in 2 tracks"),
        T("Tue: Count bars in popular songs", 20),
        T("Wed: Color‑code waveforms in Rekordbox", 20),
        Challenge("Thu: Identify 3 sections of a random track live", 30),
        Side("Find & mark song structure of your favorite non‑DJ track", 25),
      ]),
      W(3, "Unit 1 — Starter Region", "Cueing Basics", [
        T("Mon: Hot cues + headphone cue", 20),
        Wellness("Keep headphone levels safe"),
        Portfolio("Save first cue playlist"),
        T("Tue: Set cue points in Rekordbox", 20),
        T("Wed: Practice cueing multiple songs", 20),
        Side("Hot Cue Hunter — set 5 cues in under 1 min", 25),
        Challenge("Thu: Cue a track in 30 seconds", 30),
      ]),
      W(4, "Unit 1 — Starter Region", "Track Selection & Energy", [
        T("Mon: Energy flow + crate digging", 20),
        Wellness("Don’t panic — breathe before choosing"),
        Portfolio("3‑song energy curve playlist"),
        T("Tue: Energy progression in a set (guided)", 20),
        T("Wed: Build crates (lab)", 20),
        Challenge("Thu: Present playlists; peers vote", 30),
        T("Scenario: Bride requests slow jam mid‑hype set — plan response", 0, "class"),
      ]),
      W(5, "Unit 1 — Starter Region", "First Transitions", [
        T("Mon: Crossfader + volume fader basics", 20),
        Wellness("Posture — don’t lean on faders"),
        Portfolio("Record 30‑second transition"),
        T("Tue: Crossfade 2 songs (guided)", 20),
        T("Wed: EQ vs crossfade transitions (lab)", 20),
        Challenge("Thu: Perform 1 clean transition", 30),
        Side("Genre Jumper — mix 2 different genres", 25),
      ]),
      W(6, "Unit 1 — Starter Region", "Gym Leader Challenge — Cue Badge", [
        T("Mon: Review gear, cue, crossfade", 20),
        Wellness("Nerves — breathe & prep"),
        Portfolio("Submit diagram, cue list, playlist, transition recording"),
        T("Tue: Mock test (run full routine)", 20),
        T("Wed: Peer review — refine", 20),
        Challenge("Thu Exam: Identify gear + cue track + 2‑song transition", 100),
      ], { name: "Cue Badge", when: "Thu" }),
    ];

    function generateTemplateWeeks(start, end, unitName, weeklyTheme, badgeAtEnd, badgeName) {
      const weeks = [];
      for (let w = start; w <= end; w++) {
        const weekIndex = w - start + 1;
        const title = \`\${weeklyTheme} — Week \${weekIndex}\`;
        const base = [
          T("Mon: Lesson & notes", 20),
          Portfolio("Portfolio task (upload/log)"),
          T("Tue: Guided practice", 20),
          T("Wed: Lab practice", 20),
          Challenge("Thu: Weekly challenge", 30),
          Side("Optional side quest", 25),
        ];
        const badge = badgeAtEnd && w === end ? { name: badgeName, when: "Thu" } : undefined;
        weeks.push(W(w, unitName, title, base, badge));
      }
      return weeks;
    }

    const weeks7to12 = generateTemplateWeeks(7, 12, "Unit 2 — Rhythm City", "Rhythm & Beatmatching", true, "Beat Badge");
    const weeks13to18 = generateTemplateWeeks(13, 18, "Unit 3 — Harmony Heights", "Harmony & Keys", true, "Harmony Badge");
    const weeks19to24 = generateTemplateWeeks(19, 24, "Unit 4 — Remix Canyon", "Sampling & Remix", true, "Remix Badge");
    const weeks25to27 = generateTemplateWeeks(25, 27, "Unit 5 — Setup Summit", "Setups & Troubleshooting", true, "Setup Badge");
    const weeks28to31 = generateTemplateWeeks(28, 31, "Unit 6 — Styles Arena", "Styles & Roles", true, "Style Badge");
    const weeks32to34 = generateTemplateWeeks(32, 34, "Unit 7 — Genre Forge", "Global Genres", true, "Genre Badge");
    const weeks35to36 = generateTemplateWeeks(35, 36, "Unit 8 — Turntablist Tower", "Scratching & Battles", true, "Scratch Badge");

    const CURRICULUM = [
      ...weeksDetailed,
      ...weeks7to12,
      ...weeks13to18,
      ...weeks19to24,
      ...weeks25to27,
      ...weeks28to31,
      ...weeks32to34,
      ...weeks35to36,
    ];

    const SHOP = [
      { id: "sticker", name: "Sticker", cost: 50 },
      { id: "cue-pin", name: "Cue Badge Pin", cost: 200 },
      { id: "song-request", name: "Song Request Pass", cost: 120 },
      { id: "extra-credit", name: "Extra Credit +25 XP", cost: 100 },
      { id: "dj-pass", name: "Lunch DJ Slot", cost: 250 },
      { id: "boss-battle", name: "Boss Battle: 1v1 DJ", cost: 180 },
    ];

    function Header({ activeWeek, setActiveWeek, totalWeeks }) {
      return React.createElement("div", { className: "flex flex-col gap-3 md:flex-row md:items-end md:justify-between" },
        React.createElement("div", null,
          React.createElement("h1", { className: "text-3xl font-bold" }, "DJ Journey Tracker v8"),
          React.createElement("p", { className: "text-sm text-gray-500 muted" }, "XP • Attendance • Badges • Rewards — saved locally")
        ),
        React.createElement("div", { className: "flex items-center gap-2" },
          React.createElement("label", { className: "text-sm" }, "Week"),
          React.createElement("input", {
            type: "number", min: 1, max: totalWeeks, value: activeWeek,
            onChange: (e) => setActiveWeek(Number(e.target.value)),
            className: "w-20 rounded-xl border px-3 py-1 input"
          })
        )
      );
    }

    function StudentManager({ students, setStudents, setActiveStudentId }) {
      const [name, setName] = useState("");
      const add = () => {
        if (!name.trim()) return;
        const s = { id: uid(), name: name.trim(), xp: 0, badges: [], notes: "", attendance: {}, completed: {}, purchases: [] };
        setStudents((arr) => [...arr, s]);
        setName("");
        setActiveStudentId(s.id);
      };
      const remove = (id) => setStudents((arr) => arr.filter((s) => s.id !== id));
      const rename = (id, newName) => setStudents((arr) => arr.map((s) => (s.id === id ? { ...s, name: newName } : s)));
      return React.createElement("div", { className: "card" },
        React.createElement("h2", { className: "mb-2 text-xl font-semibold" }, "Students"),
        React.createElement("div", { className: "mb-3 flex gap-2" },
          React.createElement("input", {
            placeholder: "Add student name", value: name,
            onChange: (e) => setName(e.target.value),
            onKeyDown: (e) => e.key === "Enter" && add(),
            className: "flex-1 input"
          }),
          React.createElement("button", { onClick: add, className: "btn btn-primary" }, "Add")
        ),
        React.createElement("div", { className: "grid grid-cols-1 gap-2 md:grid-cols-2 lg:grid-cols-3" },
          students.map((s) => React.createElement("div", { key: s.id, className: "flex items-center justify-between card" },
            React.createElement("div", null,
              React.createElement("input", { value: s.name, onChange: (e) => rename(s.id, e.target.value), className: "input" }),
              React.createElement("div", { className: "text-xs muted" }, `XP: ${s.xp} • Badges: ${s.badges.length}`)
            ),
            React.createElement("div", { className: "flex gap-2" },
              React.createElement("button", { onClick: () => setActiveStudentId(s.id), className: "btn" }, "Open"),
              React.createElement("button", { onClick: () => remove(s.id), className: "btn", style: { color: "#dc2626" } }, "Remove")
            )
          ))
        )
      );
    }

    function XPButtons({ onGive }) {
      const amounts = [10, 20, 30, 50, 100];
      return React.createElement("div", { className: "flex flex-wrap items-center gap-2" },
        amounts.map((n) => React.createElement("button", { key: n, onClick: () => onGive(n), className: "btn" }, `+${n} XP`))
      );
    }

    function Attendance({ student, week, updateStudent }) {
      const days = ["Mon", "Tue", "Wed", "Thu"];
      const rec = (student.attendance && student.attendance[week]) || {};
      const toggle = (d) => {
        const newRec = { ...rec, [d]: !rec[d] };
        const att = { ...(student.attendance || {}), [week]: newRec };
        updateStudent({ attendance: att });
      };
      const count = days.filter((d) => rec[d]).length;
      return React.createElement("div", { className: "card" },
        React.createElement("div", { className: "mb-1 text-sm font-medium" }, `Attendance (Week ${week})`),
        React.createElement("div", { className: "flex gap-2" },
          days.map((d) => React.createElement("button", {
            key: d, onClick: () => toggle(d),
            className: "btn", style: { background: rec[d] ? "#d1fae5" : "white" }
          }, d))
        ),
        React.createElement("div", { className: "mt-2 text-xs muted" }, `Marked: ${count}/4`)
      );
    }

    function WeekTasks({ week, student, updateStudent, onAwardBadge }) {
      const data = useMemo(() => CURRICULUM.find((x) => x.w === week), [week]);
      if (!data) return React.createElement("div", { className: "muted" }, "No week data.");
      const completed = student.completed || {};
      const toggleTask = (task) => {
        const key = task.id;
        const already = !!completed[key];
        const newCompleted = { ...completed, [key]: !already };
        let delta = 0;
        if (!already) delta += task.xp || 0; else delta -= task.xp || 0;
        const newXP = Math.max(0, (student.xp || 0) + delta);
        if (data.badge && task.title.toLowerCase().includes("challenge") && !already) onAwardBadge(data.badge.name);
        updateStudent({ completed: newCompleted, xp: newXP });
      };
      return React.createElement("div", { className: "card" },
        React.createElement("div", { className: "mb-2 flex flex-wrap items-end justify-between gap-2" },
          React.createElement("div", null,
            React.createElement("div", { className: "text-xs uppercase tracking-wide muted" }, data.unit),
            React.createElement("h3", { className: "text-lg font-semibold" }, `Week ${data.w}: ${data.title}`)
          ),
          data.badge ? React.createElement("div", { className: "btn" }, `🏅 Badge Week: ${data.badge.name}`) : null
        ),
        React.createElement("ol", { className: "space-y-2" },
          data.tasks.map((t) => React.createElement("li", { key: t.id, className: "flex items-center justify-between gap-3 card" },
            React.createElement("div", null,
              React.createElement("div", { className: "font-medium" }, t.title),
              React.createElement("div", { className: "text-xs muted" }, `Type: ${t.type} ${t.xp ? "• XP " + t.xp : ""}`)
            ),
            React.createElement("button", { onClick: () => toggleTask(t), className: "btn", style: completed[t.id] ? { background: "#111827", color: "white" } : {} },
              completed[t.id] ? "Completed" : "Mark +XP")
          ))
        )
      );
    }

    function RewardShop({ student, updateStudent }) {
      const buy = (item) => {
        if ((student.xp || 0) < item.cost) return alert("Not enough XP.");
        const purchases = [...(student.purchases || []), { id: uid(), itemId: item.id, name: item.name, cost: item.cost, date: today() }];
        updateStudent({ purchases, xp: student.xp - item.cost });
      };
      return React.createElement("div", { className: "card" },
        React.createElement("div", { className: "mb-2 text-xl font-semibold" }, "Reward Shop"),
        React.createElement("div", { className: "grid grid-cols-1 gap-2 md:grid-cols-2 lg:grid-cols-3" },
          SHOP.map((it) => React.createElement("div", { key: it.id, className: "flex items-center justify-between card" },
            React.createElement("div", null,
              React.createElement("div", { className: "font-medium" }, it.name),
              React.createElement("div", { className: "text-xs muted" }, `Cost: ${it.cost} XP`)
            ),
            React.createElement("button", { onClick: () => buy(it), className: "btn" }, "Buy")
          ))
        ),
        student.purchases && student.purchases.length ? React.createElement("div", { className: "mt-3 card" },
          React.createElement("div", { className: "mb-1 text-sm font-medium" }, "Purchase History"),
          React.createElement("ul", { className: "text-sm" },
            student.purchases.map((p) => React.createElement("li", { key: p.id, className: "flex justify-between", style: { borderBottom: "1px solid #e5e7eb", padding: ".25rem 0" } },
              React.createElement("span", null, `${p.date} — ${p.name}`),
              React.createElement("span", { className: "muted" }, `-${p.cost} XP`)
            ))
          )
        ) : null
      );
    }

    function BadgeRack({ badges }) {
      if (!badges || badges.length === 0) return React.createElement("div", { className: "muted" }, "No badges yet.");
      return React.createElement("div", { className: "flex flex-wrap gap-2" },
        badges.map((b, i) => React.createElement("div", { key: i, className: "btn" }, b))
      );
    }

    function StudentPanel({ student, setStudents, week }) {
      const updateStudent = (patch) => setStudents((arr) => arr.map((s) => (s.id === student.id ? { ...s, ...patch } : s)));
      const giveXP = (n) => updateStudent({ xp: (student.xp || 0) + n });
      const awardBadge = (name) => {
        const list = student.badges || [];
        if (list.includes(name)) return;
        updateStudent({ badges: [...list, name] });
      };
      const level = 1 + Math.floor((student.xp || 0) / 100);
      return React.createElement("div", { className: "grid grid-cols-1 gap-4 md:grid-cols-3" },
        React.createElement("div", { className: "md:col-span-1 space-y-3" },
          React.createElement("div", { className: "card" },
            React.createElement("div", { className: "mb-1 text-xs uppercase tracking-wide muted" }, "Student"),
            React.createElement("div", { className: "text-2xl font-bold" }, student.name),
            React.createElement("div", { className: "mt-2 flex items-center gap-3" },
              React.createElement("div", { className: "card", style: { textAlign: "center" } },
                React.createElement("div", { className: "text-xs muted" }, "XP"),
                React.createElement("div", { className: "text-xl font-semibold" }, student.xp)
              ),
              React.createElement("div", { className: "card", style: { textAlign: "center" } },
                React.createElement("div", { className: "text-xs muted" }, "Level"),
                React.createElement("div", { className: "text-xl font-semibold" }, level)
              )
            ),
            React.createElement("div", { className: "mt-3" }, React.createElement(XPButtons, { onGive: giveXP })),
            React.createElement("div", { className: "mt-4" },
              React.createElement("div", { className: "mb-1 text-sm font-medium" }, "Badges"),
              React.createElement(BadgeRack, { badges: student.badges })
            ),
            React.createElement("div", { className: "mt-4" },
              React.createElement("label", { className: "mb-1 block text-sm font-medium" }, "Notes"),
              React.createElement("textarea", {
                value: student.notes || "",
                onChange: (e) => updateStudent({ notes: e.target.value }),
                className: "input", style: { width: "100%", height: "7rem" },
                placeholder: "Progress notes, feedback, goals..."
              })
            )
          ),
          React.createElement(Attendance, { student, week, updateStudent }),
          React.createElement(RewardShop, { student, updateStudent })
        ),
        React.createElement("div", { className: "md:col-span-2 space-y-3" },
          React.createElement(WeekTasks, { week, student, updateStudent, onAwardBadge: awardBadge })
        )
      );
    }

    function DataMenu({ data, setData }) {
      const [show, setShow] = useState(false);
      const [txt, setTxt] = useState("");
      const exportData = () => setTxt(JSON.stringify(data, null, 2));
      const importData = () => {
        try { const obj = JSON.parse(txt); setData(obj); alert("Imported."); }
        catch (e) { alert("Invalid JSON"); }
      };
      const reset = () => { if (confirm("Reset all data? This cannot be undone.")) setData({ students: [] }); };
      return React.createElement("div", { className: "card" },
        React.createElement("div", { className: "mb-2 flex items-center justify-between" },
          React.createElement("div", { className: "text-xl font-semibold" }, "Data & Backup"),
          React.createElement("button", { onClick: () => setShow((v) => !v), className: "btn" }, show ? "Hide" : "Show")
        ),
        show && React.createElement("div", { className: "space-y-2" },
          React.createElement("div", { className: "flex flex-wrap gap-2" },
            React.createElement("button", { onClick: exportData, className: "btn" }, "Export → Textbox"),
            React.createElement("button", { onClick: importData, className: "btn" }, "Import ← Textbox"),
            React.createElement("button", { onClick: reset, className: "btn", style: { color: "#dc2626" } }, "Reset")
          ),
          React.createElement("textarea", { className: "input", style: { width: "100%", height: "13rem" }, value: txt, onChange: (e) => setTxt(e.target.value), placeholder: "Paste JSON here to import, or click Export first." })
        )
      );
    }

    function App() {
      const [store, setStore] = useLocalState(STORAGE_KEY, { students: [] });
      const [activeWeek, setActiveWeek] = useState(1);
      const [activeStudentId, setActiveStudentId] = useState(null);
      const students = store.students || [];
      const setStudents = (fnOrArr) => setStore((s) => ({ ...s, students: typeof fnOrArr === "function" ? fnOrArr(s.students || []) : fnOrArr }));
      const activeStudent = students.find((s) => s.id === activeStudentId) || students[0];
      useEffect(() => { if (students.length && !activeStudentId) setActiveStudentId(students[0].id); }, [students.length]);
      return React.createElement("div", { className: "space-y-4 p-4", style: { maxWidth: "72rem", margin: "0 auto" } },
        React.createElement(Header, { activeWeek, setActiveWeek, totalWeeks: 36 }),
        React.createElement(StudentManager, { students, setStudents, setActiveStudentId }),
        activeStudent
          ? React.createElement(StudentPanel, { student: activeStudent, setStudents, week: activeWeek })
          : React.createElement("div", { className: "card", style: { textAlign: "center", color: "#6b7280" } }, "Add a student to get started."),
        React.createElement(DataMenu, { data: store, setData: setStore }),
        React.createElement("footer", { className: "pb-10 pt-2", style: { textAlign: "center", fontSize: ".75rem", color: "#9ca3af" } }, "DJ Journey Tracker v8 • Local only • Tip: Export before clearing browser storage.")
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(React.createElement(App));
  });
  </script>
</body>
</html>
